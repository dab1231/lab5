# 📊 ВИЗУАЛЬНЫЕ СХЕМЫ И ДИАГРАММЫ

## 🎯 Архитектура решения

```
┌────────────────────────────────────────────────────────────────────┐
│                         КОМАНДНАЯ СТРОКА                            │
│                                                                     │
│  java -cp bin ReflectionTask Vehicle.Auto setModelPrice BMW0 5.5M  │
│                                                                     │
│  args[0]      args[1]         args[2]       args[3]                │
│  ↓             ↓               ↓             ↓                      │
│  Vehicle.Auto  setModelPrice   BMW0          5500000               │
└────────────────────────────────────────────────────────────────────┘
                                  ↓
┌────────────────────────────────────────────────────────────────────┐
│                      REFLECTION API                                 │
│                                                                     │
│  ┌─────────────────┐                                               │
│  │ Class.forName() │  ← Загрузка класса по имени                   │
│  └────────┬────────┘                                               │
│           ↓                                                         │
│  ┌─────────────────────────────┐                                   │
│  │ getConstructor()            │  ← Поиск конструктора              │
│  └────────┬────────────────────┘                                   │
│           ↓                                                         │
│  ┌─────────────────────────────┐                                   │
│  │ newInstance()               │  ← Создание объекта               │
│  └────────┬────────────────────┘                                   │
│           ↓                                                         │
│  ┌─────────────────────────────┐                                   │
│  │ getMethod()                 │  ← Получение метода               │
│  └────────┬────────────────────┘                                   │
│           ↓                                                         │
│  ┌─────────────────────────────┐                                   │
│  │ invoke()                    │  ← Вызов метода                   │
│  └────────┬────────────────────┘                                   │
└───────────┼─────────────────────────────────────────────────────────┘
            ↓
┌────────────────────────────────────────────────────────────────────┐
│                      РЕЗУЛЬТАТ                                      │
│                                                                     │
│  Марка: TestMark                                                   │
│  Модели:                                                           │
│    • BMW0  → 5,500,000.00 руб.  ✓ ИЗМЕНЕНО                        │
│    • BMW10 → 2,843,567.00 руб.                                    │
│    • BMW20 → 3,912,345.00 руб.                                    │
└────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 Поток выполнения программы

```
START
  │
  ├─→ [1] Чтение параметров командной строки
  │        │
  │        ├─ className  = "Vehicle.Auto"
  │        ├─ methodName = "setModelPrice"
  │        ├─ modelName  = "BMW0"
  │        └─ price      = "5500000"
  │
  ├─→ [2] Загрузка класса через рефлексию
  │        │
  │        Class<?> clazz = Class.forName(className);
  │        │
  │        ├─ Успех → Class<Auto>
  │        └─ Ошибка → ClassNotFoundException
  │
  ├─→ [3] Создание экземпляра класса
  │        │
  │        Constructor<?> c = clazz.getConstructor(String, int);
  │        Vehicle obj = c.newInstance("TestMark", 3);
  │        │
  │        ├─ Успех → Auto объект с 3 моделями
  │        └─ Ошибка → InstantiationException
  │
  ├─→ [4] Вывод состояния ДО изменения
  │        │
  │        System.out.println(obj.toString());
  │
  ├─→ [5] Получение метода через рефлексию
  │        │
  │        Method m = clazz.getMethod(methodName, String, double);
  │        │
  │        ├─ Успех → Method объект
  │        └─ Ошибка → NoSuchMethodException
  │
  ├─→ [6] Вызов метода через рефлексию
  │        │
  │        m.invoke(obj, modelName, Double.parseDouble(price));
  │        │
  │        ├─ Успех → Цена изменена
  │        │
  │        └─ Ошибка → InvocationTargetException
  │                     │
  │                     ├─ NoSuchModelNameException
  │                     └─ ModelPriceOutOfBoundsException
  │
  ├─→ [7] Вывод состояния ПОСЛЕ изменения
  │        │
  │        System.out.println(obj.toString());
  │
  └─→ [8] Дополнительная информация о классе
           │
           ├─ Интерфейсы
           ├─ Методы
           └─ Модификаторы
           │
END
```

---

## 🏗️ Структура классов

```
┌─────────────────────────────────────────────────────────────┐
│                      <<interface>>                           │
│                        Vehicle                               │
├─────────────────────────────────────────────────────────────┤
│ + getMark(): String                                         │
│ + setMark(String): void                                     │
│ + getNames(): String[]                                      │
│ + getPrices(): double[]                                     │
│ + setModelPrice(String, double): void                       │
│ + getModelPrice(String): double                             │
│ + addNewModel(String, double): void                         │
│ + deleteModel(String): void                                 │
│ + getSize(): int                                            │
└─────────────────────────────────────────────────────────────┘
                     △                  △
                     │                  │
                     │                  │
        ┌────────────┴─────┐   ┌───────┴──────────┐
        │                  │   │                   │
┌───────┴────────┐   ┌─────┴────────┐   ┌──────────┴────────┐
│     Auto       │   │  Motorcycle  │   │  TransportTools   │
├────────────────┤   ├──────────────┤   ├───────────────────┤
│ - mark: String │   │ - mark       │   │ Static methods    │
│ - models[]     │   │ - models[]   │   │ for operations    │
├────────────────┤   ├──────────────┤   └───────────────────┘
│ + Auto()       │   │ + Motorcycle()│
│ + toString()   │   │ + toString() │
│ + equals()     │   │ + equals()   │
│ + hashCode()   │   │ + hashCode() │
│ + clone()      │   │ + clone()    │
└────────────────┘   └──────────────┘
```

---

## 🎭 Сравнение обычного вызова и рефлексии

```
╔══════════════════════════════════════════════════════════════════╗
║                    ОБЫЧНЫЙ ВЫЗОВ МЕТОДА                          ║
╠══════════════════════════════════════════════════════════════════╣
║                                                                  ║
║  ┌───────────────────────────────────────────────────────────┐  ║
║  │  Auto auto = new Auto("BMW", 3);                          │  ║
║  │                                                            │  ║
║  │  auto.setModelPrice("BMW0", 5500000.0);                   │  ║
║  └───────────────────────────────────────────────────────────┘  ║
║                                                                  ║
║  ✓ Быстро                                                        ║
║  ✓ Проверяется на этапе компиляции                               ║
║  ✓ Безопасно (типы известны)                                     ║
║  ✗ Не гибко (класс и метод фиксированы)                          ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝

                              VS

╔══════════════════════════════════════════════════════════════════╗
║                    ВЫЗОВ ЧЕРЕЗ РЕФЛЕКСИЮ                         ║
╠══════════════════════════════════════════════════════════════════╣
║                                                                  ║
║  ┌───────────────────────────────────────────────────────────┐  ║
║  │  Class<?> clazz = Class.forName("Vehicle.Auto");          │  ║
║  │                                                            │  ║
║  │  Object obj = clazz.getConstructor(String, int)           │  ║
║  │                    .newInstance("BMW", 3);                │  ║
║  │                                                            │  ║
║  │  Method method = clazz.getMethod("setModelPrice",         │  ║
║  │                                   String, double);         │  ║
║  │                                                            │  ║
║  │  method.invoke(obj, "BMW0", 5500000.0);                   │  ║
║  └───────────────────────────────────────────────────────────┘  ║
║                                                                  ║
║  ✓ Очень гибко (класс и метод из строк)                          ║
║  ✓ Динамическая загрузка классов                                 ║
║  ✗ Медленнее обычного вызова                                     ║
║  ✗ Ошибки только в runtime                                       ║
║  ✗ Сложнее в отладке                                             ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝
```

---

## 🔍 Жизненный цикл Reflection API

```
╔═══════════════════════════════════════════════════════════════════╗
║  ФАЗА 1: ЗАГРУЗКА КЛАССА                                          ║
╚═══════════════════════════════════════════════════════════════════╝

    String className = "Vehicle.Auto"
              │
              ▼
    ┌─────────────────────┐
    │  ClassLoader        │  Проверяет наличие класса
    └─────────┬───────────┘
              │
              ▼
    ┌─────────────────────┐
    │  JVM загружает      │  Читает .class файл
    │  байт-код класса    │
    └─────────┬───────────┘
              │
              ▼
    ┌─────────────────────┐
    │  Создаётся объект   │
    │  Class<Auto>        │  Метаинформация о классе
    └─────────────────────┘

╔═══════════════════════════════════════════════════════════════════╗
║  ФАЗА 2: АНАЛИЗ СТРУКТУРЫ                                         ║
╚═══════════════════════════════════════════════════════════════════╝

    Class<Auto> clazz
         │
         ├─→ getConstructors()  → Список конструкторов
         │                         • Auto(String, int)
         │
         ├─→ getMethods()        → Список методов
         │                         • setModelPrice(String, double)
         │                         • getModelPrice(String)
         │                         • addNewModel(String, double)
         │                         • ...
         │
         ├─→ getFields()         → Список полей
         │                         • mark
         │                         • models[]
         │
         └─→ getInterfaces()     → Список интерфейсов
                                   • Vehicle
                                   • Serializable
                                   • Cloneable

╔═══════════════════════════════════════════════════════════════════╗
║  ФАЗА 3: СОЗДАНИЕ ЭКЗЕМПЛЯРА                                      ║
╚═══════════════════════════════════════════════════════════════════╝

    Constructor<?>  constructor
         │
         ├─→ getParameterTypes()  → [String.class, int.class]
         │
         └─→ newInstance(args)
                  │
                  ▼
            ┌──────────────┐
            │  Auto object │  Новый объект в heap
            │  mark="BMW"  │
            │  models[3]   │
            └──────────────┘

╔═══════════════════════════════════════════════════════════════════╗
║  ФАЗА 4: ВЫЗОВ МЕТОДА                                             ║
╚═══════════════════════════════════════════════════════════════════╝

    Method method
         │
         ├─→ getName()           → "setModelPrice"
         ├─→ getReturnType()     → void.class
         ├─→ getParameterTypes() → [String.class, double.class]
         │
         └─→ invoke(obj, args)
                  │
                  ▼
            Выполнение метода
                  │
                  ├─→ Успех     → return value
                  │
                  └─→ Исключение → InvocationTargetException
                                    └─→ getCause() → реальное исключение
```

---

## 🎯 Дерево обработки исключений

```
                      try {
                        Код с рефлексией
                      }
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
    ClassNotFoundException  NoSuchMethodException  InstantiationException
    │                      │                      │
    │ Класс не найден      │ Метод не найден     │ Не удалось создать объект
    │                      │                      │
    └─→ Проверить имя      └─→ Проверить имя     └─→ Проверить конструктор
        класса                 и параметры           
                               метода

                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
    InvocationTargetException  IllegalAccessException  NumberFormatException
    │                         │                       │
    │ Ошибка при выполнении   │ Нет доступа          │ Неверный формат числа
    │                         │                       │
    │ getCause():              └─→ setAccessible(true) └─→ Проверить параметр
    │   │
    │   ├─→ NoSuchModelNameException
    │   │     "Модель не найдена"
    │   │
    │   └─→ ModelPriceOutOfBoundsException
    │         "Цена вне диапазона"
    │
    └─→ Обработать реальное исключение
```

---

## 📊 Карта памяти Reflection API

```
┌─────────────────────────────────────────────────────────────────┐
│                        HEAP MEMORY                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────┐                 │
│  │  Class<Auto> Object                        │                 │
│  ├────────────────────────────────────────────┤                 │
│  │  name: "Vehicle.Auto"                      │                 │
│  │  package: "Vehicle"                        │                 │
│  │  interfaces: [Vehicle, Serializable, ...]  │                 │
│  │  methods: [Method@123, Method@456, ...]    │◄────┐           │
│  │  constructors: [Constructor@789, ...]      │     │           │
│  │  fields: [Field@101, Field@112, ...]       │     │           │
│  └────────────────────────────────────────────┘     │           │
│                                                      │           │
│  ┌────────────────────────────────────────────┐     │           │
│  │  Method Object                             │     │           │
│  ├────────────────────────────────────────────┤     │           │
│  │  name: "setModelPrice"                     │◄────┤           │
│  │  returnType: void.class                    │     │           │
│  │  parameterTypes: [String, double]          │     │           │
│  │  declaringClass: Auto.class  ──────────────┘     │           │
│  └────────────────────────────────────────────┘                 │
│                                                                  │
│  ┌────────────────────────────────────────────┐                 │
│  │  Auto Instance                             │                 │
│  ├────────────────────────────────────────────┤                 │
│  │  mark: "BMW"                               │                 │
│  │  models: [                                 │                 │
│  │    Model("BMW0", 5500000.0),  ◄── ИЗМЕНЕНО│                 │
│  │    Model("BMW10", 2843567.0),             │                 │
│  │    Model("BMW20", 3912345.0)              │                 │
│  │  ]                                         │                 │
│  └────────────────────────────────────────────┘                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🚦 Последовательность вызовов

```
USER (командная строка)
  │
  │ java ReflectionTask Vehicle.Auto setModelPrice BMW0 5500000
  │
  ▼
┌──────────────────────────────────────┐
│  main(String[] args)                 │
│  ┌────────────────────────────────┐  │
│  │ [1] Parse arguments            │  │
│  │     className  = args[0]       │  │
│  │     methodName = args[1]       │  │
│  │     modelName  = args[2]       │  │
│  │     price      = args[3]       │  │
│  └────────────────────────────────┘  │
│                 │                    │
│                 ▼                    │
│  ┌────────────────────────────────┐  │
│  │ [2] Class.forName(className)   │─────┐
│  └────────────────────────────────┘  │  │
│                 │                    │  │
│                 ▼                    │  ▼
│  ┌────────────────────────────────┐  │ ClassLoader
│  │ [3] Get Constructor            │  │  loads class
│  │     getConstructor(String,int) │◄─┘
│  └────────────────────────────────┘  │
│                 │                    │
│                 ▼                    │
│  ┌────────────────────────────────┐  │
│  │ [4] Create Instance            │  │
│  │     newInstance("BMW", 3)      │─────┐
│  └────────────────────────────────┘  │  │
│                 │                    │  │
│                 ▼                    │  ▼
│  ┌────────────────────────────────┐  │ New Auto
│  │ [5] Print BEFORE state         │  │ object in
│  │     System.out.println(...)    │  │ heap memory
│  └────────────────────────────────┘  │
│                 │                    │
│                 ▼                    │
│  ┌────────────────────────────────┐  │
│  │ [6] Get Method                 │  │
│  │     getMethod(methodName, ...) │  │
│  └────────────────────────────────┘  │
│                 │                    │
│                 ▼                    │
│  ┌────────────────────────────────┐  │
│  │ [7] Invoke Method              │  │
│  │     invoke(obj, name, price)   │─────┐
│  └────────────────────────────────┘  │  │
│                 │                    │  │
│                 ▼                    │  ▼
│  ┌────────────────────────────────┐  │ setModelPrice()
│  │ [8] Print AFTER state          │  │ executes
│  │     System.out.println(...)    │  │
│  └────────────────────────────────┘  │
│                 │                    │
│                 ▼                    │
│  ┌────────────────────────────────┐  │
│  │ [9] Print Class Info           │  │
│  │     interfaces, methods, etc.  │  │
│  └────────────────────────────────┘  │
└──────────────────────────────────────┘
```

---

## 🎨 Визуализация производительности

```
ВРЕМЯ ВЫПОЛНЕНИЯ (микросекунды)

Прямой вызов:
████ 0.1 µs

Reflection (первый раз):
████████████████████████████████████████████████████ 5.0 µs

Reflection (кэшированный):
████████████████ 1.5 µs

═══════════════════════════════════════════════════════════
Выводы:
- Рефлексия в ~50 раз медленнее первого вызова
- Кэширование Method объектов ускоряет на ~70%
- Для редких операций разница незаметна
- Для циклов с миллионами итераций - критично
```

---

## 💡 Когда использовать рефлексию?

```
╔══════════════════════════════════════════════════════════════════╗
║                  ИСПОЛЬЗУЙ РЕФЛЕКСИЮ                             ║
╠══════════════════════════════════════════════════════════════════╣
║                                                                  ║
║  ✅ Создание фреймворков (Spring, Hibernate)                     ║
║  ✅ Dependency Injection                                         ║
║  ✅ Тестовые фреймворки (JUnit)                                  ║
║  ✅ Сериализация/Десериализация                                  ║
║  ✅ ORM (Object-Relational Mapping)                              ║
║  ✅ Плагины и расширения                                         ║
║  ✅ Аннотации и их обработка                                     ║
║  ✅ IDE и инструменты разработки                                 ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝

╔══════════════════════════════════════════════════════════════════╗
║                 НЕ ИСПОЛЬЗУЙ РЕФЛЕКСИЮ                           ║
╠══════════════════════════════════════════════════════════════════╣
║                                                                  ║
║  ❌ Обычная бизнес-логика приложения                             ║
║  ❌ Критичные к производительности участки                       ║
║  ❌ Простые операции CRUD                                        ║
║  ❌ Когда типы известны на этапе компиляции                      ║
║  ❌ Работа с приватными полями (нарушение инкапсуляции)          ║
║                                                                  ║
╚══════════════════════════════════════════════════════════════════╝
```

---

**Эти диаграммы помогут визуально объяснить работу рефлексии на защите!** 🎓
